<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SoloQ Cerditos</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>SoloQ Cerditos - Estado de los Jugadores</h1>
    <p>Última actualización: {{ timestamp | timestamp_to_datetime }}</p>
    {% if datos_jugadores %}
        <table>
            <tr>
                <th>Jugador</th>
                <th>Game Name</th>
                <th>Tier</th>
                <th>Rango</th>
                <th>Puntos</th>
                <th>En Partida</th>
                <th>Campeón</th>
                <th>Perfil</th>
                <th>In-Game</th>
            </tr>
            {% for jugador in datos_jugadores %}
                <tr>
                    <td>{{ jugador.jugador }}</td>
                    <td>{{ jugador.game_name }}</td>
                    <td>{{ jugador.tier }}</td>
                    <td>{{ jugador.rank }}</td>
                    <td>{{ jugador.league_points }}</td>
                    <td>{{ "Sí" if jugador.en_partida else "No" }}</td>
                    <td>{{ jugador.nombre_campeon }}</td>
                    <td><a href="{{ jugador.url_perfil }}" target="_blank">Ver</a></td>
                    <td><a href="{{ jugador.url_ingame }}" target="_blank">Ver</a></td>
                </tr>
            {% endfor %}
        </table>
        <h2>Chatbot</h2>
        <form id="chatForm">
            <input type="text" id="message" name="message" placeholder="Escribe tu mensaje...">
            <button type="submit">Enviar</button>
        </form>
        <div id="chatResponse"></div>
        <script>
            document.getElementById('chatForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = document.getElementById('message').value;
                const responseDiv = document.getElementById('chatResponse');
                responseDiv.innerHTML = 'Cargando...';
                const response = await fetch(`/chat?message=${encodeURIComponent(message)}`);
                const data = await response.json();
                responseDiv.innerHTML = data.reply;
                document.getElementById('message').value = '';
            });
            function timestamp_to_datetime(timestamp) {
                return new Date(timestamp * 1000).toLocaleString();
            }
            document.querySelectorAll('time').forEach(el => {
                el.textContent = timestamp_to_datetime(parseInt(el.textContent));
            });
        </script>
    {% else %}
        <p>No hay datos de jugadores disponibles.</p>
    {% endif %}
</body>
</html>
