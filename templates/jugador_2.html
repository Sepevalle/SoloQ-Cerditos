<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Jugador - {{ perfil.nombre }}</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/Icono.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/style.css">
    <!-- Estilos específicos para esta página -->
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }

        .banner-img {
            margin-top: 40px;
            width: 100%;
            max-height: 600px;
            object-fit: contain;
        }

        .small-text {
            font-size: 0.6em;
            font-weight: normal;
            color: #6c757d;
        }

        .small-text-stats {
            font-size: 0.8em;
            color: #6c757d;
        }

        .win-rate-alto {
            color: #228B22 !important;
        }

        .win-rate-bajo {
            color: tomato !important;
        }

        .peak-elo {
            color: gold;
            font-weight: bold;
        }

        .estado-en-partida {
            color: #007BFF !important;
            font-weight: bold;
        }

        .table a {
            color: inherit;
            text-decoration: none;
        }

        .link-estado {
            color: #007BFF;
        }

        .link-perfil:hover,
        .link-estado:hover {
            text-decoration: underline;
        }

        .opgg-link {
            display: inline-block;
            padding: 5px 10px;
            font-size: 0.9em;
            font-weight: bold;
            color: white !important;
            background-color: #0056b3;
            border-radius: 50px;
            text-decoration: none;
            transition: background-color 0.2s ease-in-out;
        }

        .opgg-link:hover {
            background-color: #004494;
        }

        .dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        .dark-mode .navbar {
            background-color: #343a40 !important;
            color: white;
        }

        .dark-mode .navbar-brand {
            color: white !important;
        }

        .dark-mode .table,
        .dark-mode .card {
            background-color: #343a40 !important;
            color: white;
        }

        .dark-mode .nav-link {
            color: white !important;
        }

        .dark-mode .navbar-toggler-icon {
            filter: invert(1) grayscale(100%) brightness(2);
        }

        .table td,
        .table th {
            text-align: center;
            vertical-align: middle;
        }

        .jugador-columna {
            text-align: left;
        }

        .hidden {
            display: none;
        }

        .imagen-jugador {
            width: 30px;
            height: 30px;
            vertical-align: middle;
            display: inline-block;
            margin-right: 8px;
            border-radius: 50%;
            object-fit: cover;
        }

        .lateral-img {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 150px;
            height: auto;
            object-fit: cover;
            display: none;
        }

        @media (min-width: 1500px) {
            .lateral-img {
                display: block;
            }

            body {
                padding-left: 180px;
                padding-right: 180px;
            }

            .navbar.fixed-top {
                left: 180px;
                right: 180px;
            }
        }

        .left-img {
            left: 20px;
        }

        .right-img {
            right: 20px;
        }

        #volumeSlider {
            width: 100px;
            margin-left: 10px;
            vertical-align: middle;
            height: 20px;
            padding: 0;
        }

        #volumeSlider::-webkit-slider-runnable-track {
            background: #6c757d;
            height: 0.2em;
            border-radius: 1em;
        }

        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
            margin-top: -6.5px;
        }

        #volumeSlider::-moz-range-track {
            background: #6c757d;
            height: 0.2em;
            border-radius: 1em;
        }

        #volumeSlider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #333;
            border: none;
            border-radius: 50px;
        }

        .dark-mode #volumeSlider::-webkit-slider-runnable-track,
        .dark-mode #volumeSlider::-moz-range-track {
            background: #495057;
        }

        .dark-mode #volumeSlider::-webkit-slider-thumb {
            background: #fff;
        }

        .dark-mode #volumeSlider::-moz-range-thumb {
            background: #fff;
        }

        .lp-gain {
            color: #228B22;
            font-weight: bold;
        }

        .lp-loss {
            color: #dc3545;
            font-weight: bold;
        }

        #toggle-mode {
            font-weight: bold;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #007bff;
            margin-bottom: 15px;
        }

        .rank-card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .rank-card .card-header {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        .rank-card .card-body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .rank-card .elo-image-lg {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .rank-details {
            text-align: center;
            width: 100%;
        }

        .rank-details h4 {
            margin-bottom: 5px;
            color: #007bff;
        }

        .rank-details p {
            margin-bottom: 3px;
        }

        .champion-stats-container {
            margin-top: 20px;
            width: 100%;
        }

        .champion-stats-item {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .champion-stats-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .champion-stats-item img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .champion-stats-info {
            text-align: center;
        }

        .champion-stats-info h5 {
            margin-bottom: 0;
            font-size: 1.1em;
        }

        .kda-text {
            font-size: 0.9em;
            color: #6c757d;
        }

        .match-history-card {
            margin-top: 40px;
        }

        .match-history-table th,
        .match-history-table td {
            vertical-align: middle;
            padding: 8px;
        }

        .match-history-table .champion-level-container {
            width: 60px;
            height: 60px;
            margin: 0 auto;
        }

        .match-history-table .champion-level {
            font-size: 0.8em;
            bottom: -8px;
            right: -8px;
            padding: 3px 6px;
            min-width: 24px;
        }

        .match-history-table .summoner-spells,
        .match-history-table .runes {
            gap: 4px;
            margin: 0 auto;
        }

        .match-history-table .summoner-spells img,
        .match-history-table .runes img {
            width: 25px;
            height: 25px;
        }

        .match-history-table .kda-text {
            font-size: 1.1em;
            font-weight: bold;
        }

        .items-layout {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            width: calc(25px * 3 + 3px * 2);
        }

        .items-grid img,
        .items-grid .item-placeholder,
        .trinket-item img,
        .trinket-item .item-placeholder {
            width: 25px;
            height: 25px;
            border-radius: 5px;
        }

        .trinket-item .item-placeholder,
        .items-grid .item-placeholder {
            border: 1px solid rgba(108, 117, 125, 0.3);
        }

        .dark-mode .trinket-item .item-placeholder,
        .dark-mode .items-grid .item-placeholder {
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .match-history-table .match-result {
            font-size: 1.1em;
        }

        .match-history-table .match-row-win>td {
            background-color: rgba(40, 167, 69, 0.08);
        }

        .match-history-table .match-row-loss>td {
            background-color: rgba(220, 53, 69, 0.08);
        }

        .dark-mode .match-history-table .match-row-win>td {
            background-color: rgba(40, 167, 69, 0.15);
        }

        .dark-mode .match-history-table .match-row-loss>td {
            background-color: rgba(220, 53, 69, 0.15);
        }

        .highlight-performance {
            border-left: 4px solid #ffc107;
        }

        .multikill-badge {
            display: inline-block;
            padding: 2px 6px;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .penta-kill {
            background-color: #ff4500;
        }

        .quadra-kill {
            background-color: #9400d3;
        }

        .triple-kill {
            background-color: #dc143c;
        }

        .double-kill {
            background-color: #0056b3;
        }

        .damage-bar {
            display: flex;
            width: 100%;
            min-width: 80px;
            height: 12px;
            border-radius: 4px;
            overflow: hidden;
            background-color: #e9ecef;
            border: 1px solid #ccc;
        }

        .damage-physical {
            background-color: #ff8c00;
        }

        .damage-magic {
            background-color: #4169e1;
        }

        .damage-true {
            background-color: #f8f9fa;
        }

        .dark-mode .damage-bar {
            background-color: #212529;
            border-color: #495057;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .filter-controls label {
            margin-bottom: 0;
            font-weight: bold;
        }

        .filter-controls select {
            flex-grow: 1;
            max-width: 200px;
        }

        .champion-level-container {
            position: relative;
            display: inline-block;
        }

        .champion-level-container img {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .champion-level {
            position: absolute;
            background-color: #343a40;
            color: white;
            font-weight: bold;
            border-radius: 50%;
            text-align: center;
            border: 1px solid #6c757d;
        }

        .summoner-spells {
            display: flex;
            flex-direction: column;
        }

        .summoner-spells img {
            border-radius: 3px;
        }

        .runes {
            display: flex;
            flex-direction: column;
        }

        .runes img {
            border-radius: 50%;
        }

        .runes img.keystone {
            border: 1px solid gold;
        }

        .runes img.sub-rune {
            border: 1px solid #6c757d;
        }

        .small-text-stats {
            color: #6c757d;
        }

        .dark-mode .small-text-stats,
        .dark-mode .small-text {
            color: #adb5bd;
        }

        .details-content-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s ease-in-out;
        }

        tr:not(.hidden) .details-content-wrapper {
            grid-template-rows: 1fr;
        }

        .details-content-wrapper>div {
            overflow: hidden;
        }
    </style>
</head>

<body>

    <!-- Banners laterales (ocultos en móvil por la media query) -->
    <img id="left-banner" class="lateral-img left-img"
        src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/bannerlateral/1.jpg"
        alt="Lateral izquierda">
    <img id="right-banner" class="lateral-img right-img"
        src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/bannerlateral/1.jpg" alt="Lateral derecha">

    <!-- Audio de fondo -->
    <audio id="backgroundAudio" loop>
        <source src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/backgroundMusic.mp3"
            type="audio/mpeg">
        Tu navegador no soporta el elemento audio.
    </audio>

    <!-- Barra de navegación superior -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/Icono2.jpg" alt="Logo"
                    style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">
                Cerditos y Valientes
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 flex-column flex-lg-row">
                </ul>
                <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center">
                    <button id="toggle-mode" class="btn btn-secondary w-100 w-lg-auto mb-2 mb-lg-0">Modo Oscuro</button>
                    <div class="d-flex align-items-center ms-lg-2">
                        <button id="toggleAudio" class="btn btn-secondary" title="Desmutear Música">
                            <i id="muteIcon" class="fas fa-microphone-slash"></i>
                        </button>
                        <input id="volumeSlider" type="range" class="form-range" min="0" max="1" step="0.01" value="1">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Banner principal -->
    <div class="container my-4 d-flex justify-content-center">
        <img src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/refs/heads/main/banners/Banner5.png"
            alt="Banner" class="banner-img" id="banner-img">
    </div>

    <!-- Contenido principal, adaptado para móviles -->
    <div class="container-fluid mt-5">
        <div class="profile-header">
            <!-- Imagen de perfil dinámica -->
            <img src="{{ perfil.imagen_url }}" alt="Imagen de {{ perfil.nombre }}"
                onerror="this.onerror=null;this.src='https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/img_perfil/placeholder_perfil.png'">
            <!-- Nombre del jugador y tag dinámicos -->
            <h1>{{ perfil.nombre }} <span class="small-text">({{ perfil.tag }})</span></h1>
            <!-- Enlace a OP.GG dinámico -->
            <a href="https://www.op.gg/summoners/{{ perfil.region }}/{{ perfil.nombre }}-{{ perfil.tag }}" target="_blank"
                class="opgg-link">Ver en OP.GG</a>
        </div>

        <!-- Secciones de clasificatoria dinámicas -->
        <div class="row">
            {% for cola, datos_rank in perfil.ranks.items() %}
            <div class="col-md-6">
                <div class="card rank-card">
                    <div class="card-header">
                        Clasificatoria {{ cola }}
                    </div>
                    <div class="card-body">
                        {% if datos_rank %}
                        <img class="elo-image-lg" src="{{ datos_rank.imagen_elo }}"
                            alt="Imagen de {{ datos_rank.tier }}">
                        <div class="rank-details">
                            <h4>{{ datos_rank.tier }} {{ datos_rank.rank }}</h4>
                            <p>{{ datos_rank.lp }} LP</p>
                            <p>{{ datos_rank.victorias }} W / {{ datos_rank.derrotas }} L - <span
                                    class="{{ 'win-rate-alto' if datos_rank.win_rate >= 50 else 'win-rate-bajo' }}">
                                    {{ datos_rank.win_rate }}% WR</span></p>
                        </div>
                        {% else %}
                        <p>No se encontraron datos de clasificatoria para {{ cola }}.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Historial de Partidas dinámico -->
        <div class="card match-history-card">
            <div class="card-header">
                Historial de Partidas
            </div>
            <div class="card-body">
                {% if partidas %}
                <div class="filter-controls text-center">
                    <label for="queueFilter">Filtro por Cola:</label>
                    <select id="queueFilter" class="form-select form-select-sm"></select>
                    <label for="championFilter">Filtro por Campeón:</label>
                    <select id="championFilter" class="form-select form-select-sm"></select>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover table-striped match-history-table">
                        <tbody id="matchHistoryTableBody">
                            <!-- Contenido de las partidas inyectado por JavaScript -->
                        </tbody>
                    </table>
                </div>
                <nav>
                    <ul class="pagination justify-content-center" id="paginationControls">
                        <!-- Controles de paginación inyectados por JavaScript -->
                    </ul>
                </nav>
                {% else %}
                <p>No hay historial de partidas disponible para este jugador.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Enlaces a JS de Bootstrap y script personalizado -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Lógica para banners aleatorios (ya estaba en tu código)
            const bannerImages = [
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner1.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner2.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner3.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner4.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner5.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner6.png',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/banners/Banner7.png'
            ];
            const randomBanner = bannerImages[Math.floor(Math.random() * bannerImages.length)];
            document.getElementById('banner-img').src = randomBanner;

            // Controles de audio (ya estaba en tu código)
            const audio = document.getElementById('backgroundAudio');
            const toggleAudioBtn = document.getElementById('toggleAudio');
            const muteIcon = document.getElementById('muteIcon');
            const volumeSlider = document.getElementById('volumeSlider');
            let isMuted = true;
            audio.volume = 0.5;
            volumeSlider.value = 0.5;
            toggleAudioBtn.addEventListener('click', function () {
                if (isMuted) {
                    audio.play();
                    muteIcon.classList.remove('fa-microphone-slash');
                    muteIcon.classList.add('fa-microphone');
                    toggleAudioBtn.title = "Mutear Música";
                    isMuted = false;
                } else {
                    audio.pause();
                    muteIcon.classList.remove('fa-microphone');
                    muteIcon.classList.add('fa-microphone-slash');
                    toggleAudioBtn.title = "Desmutear Música";
                    isMuted = true;
                }
            });
            volumeSlider.addEventListener('input', function () {
                audio.volume = this.value;
                if (this.value > 0 && isMuted) {
                    isMuted = false;
                    muteIcon.classList.remove('fa-microphone-slash');
                    muteIcon.classList.add('fa-microphone');
                    toggleAudioBtn.title = "Mutear Música";
                }
                if (this.value == 0) {
                    isMuted = true;
                    muteIcon.classList.remove('fa-microphone');
                    muteIcon.classList.add('fa-microphone-slash');
                    toggleAudioBtn.title = "Desmutear Música";
                }
            });

            // Lógica para modo oscuro (ya estaba en tu código)
            const toggleModeBtn = document.getElementById('toggle-mode');
            const body = document.body;
            let darkMode = localStorage.getItem('darkMode');
            const enableDarkMode = () => {
                body.classList.add('dark-mode');
                toggleModeBtn.textContent = 'Modo Claro';
                localStorage.setItem('darkMode', 'enabled');
            };
            const disableDarkMode = () => {
                body.classList.remove('dark-mode');
                toggleModeBtn.textContent = 'Modo Oscuro';
                localStorage.setItem('darkMode', 'disabled');
            };
            if (darkMode === 'enabled') {
                enableDarkMode();
            }
            toggleModeBtn.addEventListener('click', () => {
                darkMode = localStorage.getItem('darkMode');
                if (darkMode !== 'enabled') {
                    enableDarkMode();
                } else {
                    disableDarkMode();
                }
            });

            // Banners laterales (ya estaba en tu código)
            const lateralBanners = [
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/bannerlateral/1.jpg',
                'https://raw.githubusercontent.com/Sepevalle/SoloQ-Cerditos/main/bannerlateral/2.jpg'
            ];
            const randomLateralBanner = lateralBanners[Math.floor(Math.random() * lateralBanners.length)];
            document.getElementById('left-banner').src = randomLateralBanner;
            document.getElementById('right-banner').src = randomLateralBanner;

            // --- INICIO: LÓGICA DE FILTRADO Y PAGINACIÓN DE PARTIDAS (Copiado de jugador.html) ---
            const allMatchHistory = {{ partidas | tojson }};
            let currentPage = 1;
            const itemsPerPage = 10;
            const tableBody = document.getElementById('matchHistoryTableBody');
            const paginationControls = document.getElementById('paginationControls');
            const queueFilter = document.getElementById('queueFilter');
            const championFilter = document.getElementById('championFilter');
            let filteredMatches = [];

            function renderMatchHistory() {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const matchesToRender = filteredMatches.slice(startIndex, endIndex);

                tableBody.innerHTML = '';
                if (matchesToRender.length === 0) {
                    const noMatchesRow = `<tr><td colspan="10" class="text-center">No se encontraron partidas con los filtros seleccionados.</td></tr>`;
                    tableBody.innerHTML = noMatchesRow;
                } else {
                    matchesToRender.forEach(partida => {
                        const tr = document.createElement('tr');
                        tr.className = `match-row-${partida.win_or_loss.toLowerCase()}`;
                        tr.dataset.matchId = partida.match_id;
                        tr.innerHTML = `
                            <td>
                                <div class="match-result text-white p-2 rounded-3 mb-1 {{ 'bg-success' if partida.win_or_loss == 'WIN' else 'bg-danger' }}">
                                    {{ 'Victoria' if partida.win_or_loss == 'WIN' else 'Derrota' }}
                                </div>
                                <span class="small-text-stats">{{ partida.queue_type }}</span><br>
                                <span class="small-text-stats">{{ partida.duration }}</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="champion-level-container position-relative">
                                        <img src="{{ partida.champion_icon }}" alt="{{ partida.champion }}" class="img-fluid rounded-circle">
                                        <span class="champion-level position-absolute translate-middle-x">
                                            {{ partida.champion_level }}
                                        </span>
                                    </div>
                                    <div class="d-none d-md-block ms-2 text-start">
                                        <strong>{{ partida.champion }}</strong><br>
                                        <div class="small-text-stats">{{ partida.summoner_name }}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="d-none d-md-table-cell">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="summoner-spells mb-1">
                                        <img src="{{ partida.spell1_icon }}" alt="Spell 1" class="img-fluid rounded">
                                        <img src="{{ partida.spell2_icon }}" alt="Spell 2" class="img-fluid rounded">
                                    </div>
                                    <div class="runes">
                                        <img src="{{ partida.keystone_icon }}" alt="Keystone Rune" class="img-fluid keystone">
                                        <img src="{{ partida.sub_rune_icon }}" alt="Sub Rune" class="img-fluid sub-rune">
                                    </div>
                                </div>
                            </td>
                            <td>
                                <strong class="kda-text">{{ partida.kills }}/{{ partida.deaths }}/{{ partida.assists }}</strong><br>
                                <span class="small-text-stats">KDA: {{ '%.2f' | format(partida.kda) }}</span><br>
                                {% if partida.multikill %}
                                <span class="multikill-badge {{ 'penta-kill' if partida.multikill == 'Penta Kill' else ('quadra-kill' if partida.multikill == 'Quadra Kill' else 'triple-kill') }}">{{ partida.multikill }}</span>
                                {% endif %}
                            </td>
                            <td class="d-none d-lg-table-cell">
                                <span class="small-text-stats">{{ partida.cs }} CS ({{ '%.1f' | format(partida.cs_per_min) }} /min)</span><br>
                                <span class="small-text-stats">{{ partida.gold_earned | int / 1000 }}k gold</span>
                            </td>
                            <td class="d-none d-md-table-cell">
                                <div class="items-layout">
                                    <div class="items-grid">
                                        {% for item in partida.items %}
                                        {% if item %}
                                        <img src="{{ item }}" alt="Item" class="img-fluid">
                                        {% else %}
                                        <div class="item-placeholder"></div>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="trinket-item ms-2">
                                        {% if partida.trinket %}
                                        <img src="{{ partida.trinket }}" alt="Trinket" class="img-fluid">
                                        {% else %}
                                        <div class="item-placeholder"></div>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="details-row hidden" id="match-{{ partida.match_id }}">
                            <td colspan="10">
                                <div class="details-content-wrapper">
                                    <div class="p-3">
                                        <div class="row">
                                            <!-- Damage Chart -->
                                            <div class="col-12 col-lg-6 mb-3">
                                                <h6>Daño a campeones</h6>
                                                <div class="damage-bar">
                                                    <div class="damage-physical"
                                                        style="width: {{ '%.2f' | format(partida.damage_chart.physical_percentage) }}%;"></div>
                                                    <div class="damage-magic"
                                                        style="width: {{ '%.2f' | format(partida.damage_chart.magic_percentage) }}%;"></div>
                                                    <div class="damage-true"
                                                        style="width: {{ '%.2f' | format(partida.damage_chart.true_percentage) }}%;"></div>
                                                </div>
                                                <div class="small-text-stats mt-1">
                                                    <span>Físico: {{ '%.0f' | format(partida.damage_chart.physical_damage) }}</span>,
                                                    <span>Mágico: {{ '%.0f' | format(partida.damage_chart.magic_damage) }}</span>,
                                                    <span>Verdadero: {{ '%.0f' | format(partida.damage_chart.true_damage) }}</span>
                                                </div>
                                            </div>
                                            <!-- Players List (example, can be more detailed) -->
                                            <div class="col-12 col-lg-6 mb-3">
                                                <h6>Jugadores</h6>
                                                <div class="row">
                                                    {% for jugador in partida.players %}
                                                    <div class="col-6 mb-2 d-flex align-items-center">
                                                        <img src="{{ jugador.champion_icon }}"
                                                            alt="{{ jugador.champion_name }}"
                                                            style="width: 20px; height: 20px; border-radius: 50%; margin-right: 5px;">
                                                        <a href="/jugador/{{ jugador.summoner_name }}" class="small-text-stats">
                                                            {{ jugador.summoner_name }}
                                                        </a>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        `;
                        tableBody.appendChild(tr);
                    });
                }
                renderPaginationControls(filteredMatches.length);
            }

            function renderPaginationControls(totalItems) {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                paginationControls.innerHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === currentPage ? 'active' : ''} ${totalPages <= 1 ? 'd-none' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                    paginationControls.appendChild(li);
                }
            }

            function populateQueueFilter() {
                const queueNames = {
                    420: "Clasificatoria Solo/Duo",
                    430: "Clasificatoria Flexible",
                    450: "ARAM",
                    900: "URF",
                    1400: "Ultimate Spellbook",
                    1900: "URF (ARAM)"
                };
                let options = '<option value="">Todos los modos</option>';
                const uniqueQueues = new Set(allMatchHistory.map(p => p.queue_id));
                uniqueQueues.forEach(queueId => {
                    if (queueNames[queueId]) {
                        options += `<option value="${queueId}">${queueNames[queueId]}</option>`;
                    }
                });
                queueFilter.innerHTML = options;
            }

            function populateChampionFilter() {
                let options = '<option value="">Todos los campeones</option>';
                const uniqueChampions = new Set(allMatchHistory.map(p => p.champion));
                const sortedChampions = Array.from(uniqueChampions).sort();
                sortedChampions.forEach(champion => {
                    options += `<option value="${champion}">${champion}</option>`;
                });
                championFilter.innerHTML = options;
            }

            function filterMatches() {
                const selectedQueue = queueFilter.value;
                const selectedChampion = championFilter.value;

                filteredMatches = allMatchHistory.filter(partida => {
                    const queueMatch = selectedQueue === "" || partida.queue_id == selectedQueue;
                    const championMatch = selectedChampion === "" || partida.champion === selectedChampion;
                    return queueMatch && championMatch;
                });
                currentPage = 1;
                renderMatchHistory();
            }

            // Event Listeners para filtros
            queueFilter.addEventListener('change', filterMatches);
            championFilter.addEventListener('change', filterMatches);

            // Event Listener para paginación
            paginationControls.addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.target.closest('.page-link');
                if (!target || target.parentElement.classList.contains('active')) return;
                const newPage = parseInt(target.dataset.page, 10);
                if (!isNaN(newPage)) {
                    currentPage = newPage;
                    renderMatchHistory();
                }
            });

            // Inicialización de la lógica
            if (allMatchHistory && allMatchHistory.length > 0) {
                populateQueueFilter();
                populateChampionFilter();
                filterMatches(); // Llama a filterMatches para renderizar la tabla inicial
            }
            // --- FIN: LÓGICA DE FILTRADO Y PAGINACIÓN DE PARTIDAS ---

            // Evento para expandir/colapsar detalles de la partida
            tableBody.addEventListener('click', function (e) {
                const row = e.target.closest('tr');
                if (!row || row.classList.contains('details-row')) return;

                const matchId = row.dataset.matchId;
                const detailsRow = document.getElementById(`match-${matchId}`);
                if (detailsRow) {
                    detailsRow.classList.toggle('hidden');
                }
            });

        });
    </script>
</body>

</html>